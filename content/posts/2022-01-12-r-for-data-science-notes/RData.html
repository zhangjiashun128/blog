---
title: R for Data Science notes chapter1
author: zhangjiashun
date: '2022-01-12'
slug: []
categories:
  - R
tags:
  - R
  - Data
description: ~
featured_image: ~
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p><a href="http://vita.had.co.nz/papers/layered-grammar.pdf">ggplot2语法深入学习</a></p>
<p><a href="https://exts.ggplot2.tidyverse.org/gallery/">ggplot2画图例子</a></p>
<p>当遇到有冲突的包时，使用<code>package::function()</code>.</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --</code></pre>
<pre><code>## v ggplot2 3.3.5     v purrr   0.3.4
## v tibble  3.1.5     v dplyr   1.0.7
## v tidyr   1.1.4     v stringr 1.4.0
## v readr   2.0.2     v forcats 0.5.1</code></pre>
<pre><code>## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(patchwork)</code></pre>
<pre class="r"><code>mpg</code></pre>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model      displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 audi         a4           1.8  1999     4 auto~ f        18    29 p     comp~
##  2 audi         a4           1.8  1999     4 manu~ f        21    29 p     comp~
##  3 audi         a4           2    2008     4 manu~ f        20    31 p     comp~
##  4 audi         a4           2    2008     4 auto~ f        21    30 p     comp~
##  5 audi         a4           2.8  1999     6 auto~ f        16    26 p     comp~
##  6 audi         a4           2.8  1999     6 manu~ f        18    26 p     comp~
##  7 audi         a4           3.1  2008     6 auto~ f        18    27 p     comp~
##  8 audi         a4 quattro   1.8  1999     4 manu~ 4        18    26 p     comp~
##  9 audi         a4 quattro   1.8  1999     4 auto~ 4        16    25 p     comp~
## 10 audi         a4 quattro   2    2008     4 manu~ 4        20    28 p     comp~
## # ... with 224 more rows</code></pre>
<pre class="r"><code>ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy))</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<table>
<caption>mpg数据框中变量说明</caption>
<colgroup>
<col width="10%" />
<col width="89%" />
</colgroup>
<thead>
<tr class="header">
<th>variable</th>
<th>describe</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>displ</td>
<td>engine displacement, in litres</td>
</tr>
<tr class="even">
<td>year</td>
<td>year of manufacture</td>
</tr>
<tr class="odd">
<td>cyl</td>
<td>number of cylinders</td>
</tr>
<tr class="even">
<td>trans</td>
<td>type of transmission</td>
</tr>
<tr class="odd">
<td>drv</td>
<td>the type of drive train, where f = front-wheel drive, r = rear wheel drive, 4 = 4wd</td>
</tr>
<tr class="even">
<td>cty</td>
<td>city miles per gallon</td>
</tr>
<tr class="odd">
<td>hwy</td>
<td>highway miles per gallon</td>
</tr>
<tr class="even">
<td>fl</td>
<td>fuel type</td>
</tr>
<tr class="odd">
<td>class</td>
<td>“type” of car</td>
</tr>
</tbody>
</table>
<pre class="r"><code>nrow(mpg)</code></pre>
<pre><code>## [1] 234</code></pre>
<pre class="r"><code>ggplot(data = mpg) +
  geom_point(mapping = aes(x = hwy, y = cyl))</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div id="aesthetic-mappings" class="section level2">
<h2>Aesthetic mappings</h2>
<p>通过<code>color</code>控制点的颜色：</p>
<pre class="r"><code>ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy, color = class))</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>通过<code>size</code>控制点的大小：</p>
<pre class="r"><code>ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, size = class))</code></pre>
<pre><code>## Warning: Using size for a discrete variable is not advised.</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>通过<code>alpha</code>控制点的透明度</p>
<pre class="r"><code>ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, alpha = class))</code></pre>
<pre><code>## Warning: Using alpha for a discrete variable is not advised.</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>通过<code>shape</code>控制点的形状：</p>
<pre class="r"><code>ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, shape = class))</code></pre>
<pre><code>## Warning: The shape palette can deal with a maximum of 6 discrete values because
## more than 6 becomes difficult to discriminate; you have 7. Consider
## specifying shapes manually if you must have them.</code></pre>
<pre><code>## Warning: Removed 62 rows containing missing values (geom_point).</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = &quot;blue&quot;)</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="facets" class="section level2">
<h2>Facets</h2>
<div id="通过一个变量分面" class="section level3">
<h3>通过一个变量分面</h3>
<pre class="r"><code>ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y =hwy)) +
  facet_wrap(~ class, nrow = 2)</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="通过两个变量分面" class="section level3">
<h3>通过两个变量分面</h3>
<pre class="r"><code>ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(drv ~ cyl)</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(. ~ cyl)</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(cyl ~ .)</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_wrap(~ class, nrow = 2)</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
</div>
<div id="geometric-objects" class="section level2">
<h2>Geometric objects</h2>
<pre class="r"><code>ggplot(data = mpg) + 
  geom_smooth(mapping = aes(x = displ, y = hwy))</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg) + 
  geom_smooth(mapping = aes(x = displ, y = hwy, linetype = drv))</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre class="r"><code>p1 &lt;- ggplot(data = mpg) +
  geom_smooth(mapping = aes(x = displ, y = hwy))
p2 &lt;- ggplot(data = mpg) +
  geom_smooth(mapping = aes(x = displ, y = hwy, group = drv))
p3 &lt;- ggplot(data = mpg) +
  geom_smooth(
    mapping = aes(x = displ, y = hwy, color = drv),
    show.legend = FALSE
  )</code></pre>
<pre class="r"><code>p1 + p2 + p3 + plot_layout(nrow = 1)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy)) +
  geom_smooth(mapping = aes(x = displ, y = hwy))</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>简略版代码：</p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
  geom_point() +
  geom_smooth()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
  geom_point(mapping = aes(color = class)) +
  geom_smooth()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point(mapping = aes(color = class)) + 
  geom_smooth(data = filter(mpg, class == &quot;subcompact&quot;), se = FALSE #不显示置信区间
              )</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = drv)) + 
  geom_point() + 
  geom_smooth(se = FALSE)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>练习中的图的重现代码：</p>
<pre class="r"><code>p11 &lt;- ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
  geom_point() +
  geom_smooth(se = F)</code></pre>
<pre class="r"><code>p12 &lt;- ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
  geom_point() +
  geom_smooth(mapping = aes(group = drv), se = F)</code></pre>
<pre class="r"><code>p13 &lt;- ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = drv)) +
  geom_point() +
  geom_smooth(se = F)</code></pre>
<pre class="r"><code>p14 &lt;- ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
  geom_point(mapping = aes(color = drv)) +
  geom_smooth(se = F)</code></pre>
<pre class="r"><code>p15 &lt;- ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
  geom_point(mapping = aes(color = drv)) +
  geom_smooth(se = F, mapping = aes(linetype = drv))</code></pre>
<pre class="r"><code>p16 &lt;- ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
  geom_point(mapping = aes(color = drv))</code></pre>
<pre class="r"><code>p11 + p12 + p13 + p14 + p15 + p16 + plot_layout(nrow = 3)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
</div>
<div id="statistical-transformations" class="section level2">
<h2>Statistical transformations</h2>
<pre class="r"><code>ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut))</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>每个geom都有一个默认的stat,每个stat都有一个默认的geom:</p>
<pre class="r"><code>ggplot(data = diamonds) + 
  stat_count(mapping = aes(x = cut))</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<pre class="r"><code>demo &lt;- tribble(
  ~cut,         ~freq,
  &quot;Fair&quot;,       1610,
  &quot;Good&quot;,       4906,
  &quot;Very Good&quot;,  12082,
  &quot;Premium&quot;,    13791,
  &quot;Ideal&quot;,      21551
)</code></pre>
<pre class="r"><code>demo </code></pre>
<pre><code>## # A tibble: 5 x 2
##   cut        freq
##   &lt;chr&gt;     &lt;dbl&gt;
## 1 Fair       1610
## 2 Good       4906
## 3 Very Good 12082
## 4 Premium   13791
## 5 Ideal     21551</code></pre>
<pre class="r"><code>ggplot(data = demo) +
  geom_bar(mapping = aes(x = cut, y = freq), stat = &quot;identity&quot;)</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, y = stat(prop), group = 1))</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = diamonds) + 
  stat_summary(
    mapping = aes(x = cut, y = depth),
    fun.min = min,
    fun.max = max,
    fun = median
  )</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>与上图<code>stat_summary</code>相对应的<code>geom</code>是<code>geom_pointrange</code>，但是<code>geom_pointrange</code>中默认的<code>stat</code>是<code>identity</code>，需要将使用<code>geom_pointrange(stat = summary)</code></p>
<pre class="r"><code>ggplot(data = diamonds) + 
  geom_pointrange(
    mapping = aes(x = cut, y = depth),
    stat = &quot;summary&quot;,
    fun.min = min,
    fun.max = max,
    fun = median
  )</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<pre class="r"><code>p21 &lt;- ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, y = after_stat(prop)))
p22 &lt;- ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = color, y = after_stat(prop)))</code></pre>
<pre class="r"><code>p21 + p22 + plot_layout(nrow = 1)</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
</div>
<div id="position-adjustments" class="section level2">
<h2>Position adjustments</h2>
<pre class="r"><code>p31 &lt;- ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, colour = cut))
p32 &lt;- ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = cut))</code></pre>
<pre class="r"><code>p31 + p32 + plot_layout(nrow = 2)</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity))</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<ol style="list-style-type: decimal">
<li><code>position = "identity"</code>:</li>
</ol>
<pre class="r"><code>p41 &lt;- ggplot(data = diamonds, mapping = aes(x = cut, fill = clarity)) + 
  geom_bar(alpha = 1/5, position = &quot;identity&quot;)
p42 &lt;- ggplot(data = diamonds, mapping = aes(x = cut, colour = clarity)) + 
  geom_bar(fill = NA, position = &quot;identity&quot;)</code></pre>
<pre class="r"><code>p41 / p42</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li><code>position = "fill"</code>:</li>
</ol>
<pre class="r"><code>ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity), position = &quot;fill&quot;)</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li><code>position = "dodge"</code>:</li>
</ol>
<pre class="r"><code>ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity), position = &quot;dodge&quot;)</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<ol start="4" style="list-style-type: decimal">
<li>设置<code>position = "jitter"</code>来防止点因为进位而重叠：</li>
</ol>
<pre class="r"><code>ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), position = &quot;jitter&quot;)</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) + 
  geom_jitter()</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) +
geom_count()</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg, aes(x = drv, y = hwy, colour = class)) +
geom_boxplot()</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
</div>
<div id="coordinate-systems" class="section level2">
<h2>Coordinate Systems</h2>
<ol style="list-style-type: decimal">
<li><code>coord_flip()</code>调换x轴和y轴的位置.</li>
</ol>
<pre class="r"><code>p51 &lt;- ggplot(data = mpg, mapping = aes(x = class, y = hwy)) + 
  geom_boxplot()
p52 &lt;- ggplot(data = mpg, mapping = aes(x = class, y = hwy)) + 
  geom_boxplot() +
  coord_flip()
p51 + p52</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li><code>coord_quickmap()</code>可以为地图设置合适的纵横比.</li>
</ol>
<pre class="r"><code>nz &lt;- map_data(&quot;nz&quot;)

n1 &lt;- ggplot(nz, aes(long, lat, group = group)) +
  geom_polygon(fill = &quot;white&quot;, colour = &quot;black&quot;)

n2 &lt;- ggplot(nz, aes(long, lat, group = group)) +
  geom_polygon(fill = &quot;white&quot;, colour = &quot;black&quot;) +
  coord_quickmap()
n1 + n2</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li><code>coord_polar()</code>创建极坐标:</li>
</ol>
<pre class="r"><code>bar &lt;- ggplot(data = diamonds) + 
  geom_bar(
    mapping = aes(x = cut, fill = cut), 
    show.legend = FALSE,
    width = 1
  ) + 
  theme(aspect.ratio = 1) +
  labs(x = NULL, y = NULL)

b1 &lt;- bar + coord_flip()
b2 &lt;- bar + coord_polar()
b1 + b2</code></pre>
<p><img src="/posts/2022-01-12-r-for-data-science-notes/RData_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
</div>
